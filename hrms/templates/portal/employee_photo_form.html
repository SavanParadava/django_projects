{% extends 'base.html' %} 

{% block title %}Update Profile Photo{% endblock %} 

{% block content %}
<div class="row d-flex justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          <i class="bi bi-camera-fill me-2"></i>Update Profile Photo
        </h5>
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data" novalidate>
          {% csrf_token %}

          <div class="text-center mb-4">
            <p class="text-muted">Current Photo:</p>
            {% if form.instance.photo %}
              <img src="{{ form.instance.photo.url }}" alt="Current Profile Photo" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
            {% else %}
              <div class="rounded-circle bg-secondary-subtle d-flex align-items-center justify-content-center" style="width: 150px; height: 150px;">
                  <i class="bi bi-person-fill text-secondary" style="font-size: 6rem"></i>
              </div>
            {% endif %}
          </div>
          
          <div class="text-center mb-4">
              <img id="photo-preview" src="#" alt="New photo preview" class="rounded-circle d-none" style="width: 150px; height: 150px; object-fit: cover;"/>
          </div>

          <div class="mb-3">
            <label for="{{ form.photo.id_for_label }}" class="form-label">Choose a new photo</label>
            {{ form.photo }}
            {% if form.photo.errors %}
              <div class="text-danger mt-1">
                <small>{{ form.photo.errors|striptags }}</small>
              </div>
            {% endif %}
            <div class="form-text">JPG or PNG, up to 5MB.</div>
          </div>
          
          <hr>

          <div class="d-flex justify-content-end">
            <a href="{% url 'portal:employee' %}" class="btn btn-secondary me-2">
              <i class="bi bi-x-circle me-1"></i>Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-upload me-1"></i>Save Photo
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // JavaScript for live image preview
  const photoInput = document.getElementById('{{ form.photo.id_for_label }}');
  const photoPreview = document.getElementById('photo-preview');

  photoInput.addEventListener('change', function() {
    if (this.files && this.files[0]) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        photoPreview.src = e.target.result;
        photoPreview.classList.remove('d-none'); // Make the preview visible
      }
      
      reader.readAsDataURL(this.files[0]);
    }
  });
</script>
{% endblock %}