<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Orders</title>
    <link rel="stylesheet" href="style.css">
    <script src="utils.js"></script>
</head>
<body>
    <nav>
        <h1>Order History</h1>
        <div>
            <button onclick="window.location.href='index.html'">Back to Store</button>
            <button onclick="logout()" class="logout-btn">Logout</button>
        </div>
    </nav>
    <div class="center-wrapper" style="align-items: flex-start; margin-top: 50px;">
        <div style="width: 100%; max-width: 800px;">
            <h2>Past Orders</h2>
            <div id="ordersContainer">Loading...</div>
        </div>
    </div>
    <script>
        const token = localStorage.getItem('accessToken');
        if (!token) window.location.href = 'login.html';

        async function fetchOrders() {
            const res = await authFetch(`${API_BASE}/api/store/orders/`);
            const data = await res.json();
            const orders = data.results || data;
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '';
            if (orders.length === 0) { container.innerHTML = '<p>No past orders.</p>'; return; }
            orders.forEach(o => {
                const div = document.createElement('div');
                div.className = 'product-card';
                div.style.marginBottom = '10px';
                div.innerHTML = `
                    <div class="card-header"><span style="font-weight:bold; color:#555;">Date: ${new Date(o.created_at || Date.now()).toLocaleDateString()}</span><span class="price">$${o.total_amount.toFixed(2)}</span></div>
                    <h3>${o.product.name}</h3><p>Quantity: ${o.quantity}</p>
                `;
                container.appendChild(div);
            });
        }
        fetchOrders();
    </script>
</body>
</html>
